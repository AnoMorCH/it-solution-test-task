# Тестовое задание для компании IT-Solution

<img src="https://i.imgur.com/Y6tjBPC.gif" alt="Preview" width="100%">

## Оглавление

- [Тестовое задание для компании IT-Solution](#тестовое-задание-для-компании-it-solution)
  - [Оглавление](#оглавление)
  - [Основное](#основное)
  - [Запуск тестов](#запуск-тестов)
  - [Скрипт для генерации бегущий строки](#скрипт-для-генерации-бегущий-строки)
  - [API - Генерация видеоролика с бегущей строкой](#api---генерация-видеоролика-с-бегущей-строкой)
  - [Логическая архитектура приложения](#логическая-архитектура-приложения)
  - [Docker](#docker)
  - [Тесты](#тесты)
  - [Пояснение к ТЗ](#пояснение-к-тз)

## Основное

Проект состоит из двух компонент:

* backend &ndash; хранит Django-приложение, где находится скрипт;

* frontend &ndash; содержит простой front-end клиент, который отправляет запрос на back-end.

Всё приложение помещено в Docker. Для его запуска необходимо выполнить команды:

```bash
docker compose build  # собирает приложение
docker compose up  # запускает все контейнеры
```

Docker содержит два контейнера:

* web &ndash; отвечает за работу Django-приложения;

* db &ndash; обеспечивает связь с базой данных.

Ключевые настройки расположены в `backend/Dockerfile`.

Клиент запускается при помощи открытия файла `frontend/index.html` в браузере. Его необходимо выполнять отдельно от Docker.

## Запуск тестов

```bash
1. cd backend

2. python -m venv venv

3. source venv/bin/activate

4. (venv) pip install -r requirements.txt

5. (venv) python manage.py test
```

Шаги из п.2-3 можно пропустить, если пользователь настраивает виртуальное окружение по-своему (представлен пример на Linux внутри обычного терминала, на Windows и fish-терминале процесс в этих пунктах может отличаться).

## Скрипт для генерации бегущий строки

Расположен внутри `backend/running_text_video_generator/entity/running_line_clip.py`. Реализован в виде класса. Сначала создаётся фон, потом &ndash; текст и в конце текст привязывается на фон. Видео сразу же удаляются после их создания в `RunningLineClipView` в `backend/running_text_video_generator/views.py` для предотвращения злонамеренного доступа к чужим сгенерированным видео при помощи декоратора `delete_saved_videos`. Поддерживает два формата &ndash; `mp4` и `webm`.

## API - Генерация видеоролика с бегущей строкой

Предполагается, что ответ даётся либо в JSON-формате, либо сразу в виде готового видеоролика.

* Только текст

```bash
http://0.0.0.0:8000/running_text_video_generator/?text=TEXT
```

где вместо `TEXT` необходимо вставить свой текст.

* Текст и желаемый формат (доступны только `mp4` и `webm`, по умолчанию &ndash; `mp4`)

```bash
http://0.0.0.0:8000/running_text_video_generator/?text=TEXT&fmt=FMT
```

где вместо `TEXT` необходимо вставить свой текст, вместо `FMT` &ndash; свой формат.

* Остальное

Остальные запросы выведут ошибку в формате JSON-ответа. Приложение поддерживает только GET-запросы.

## Логическая архитектура приложения

* `backend/backend` &ndash; настройки;

* `backend/media` &ndash; место для генерации видео (причём видеоролики сразу же удаляются после генерации, чтобы предотвратить злонамеренный доступ со стороны другого пользователя к чужим данным);

* `backend/running_text_video_generator` &ndash; приложение для генерации видео;

* `backend/running_text_video_generator/entity` &ndash; хранилище скрипта для генерации бегущей строки и класса для создания сообщений для отправки на клиент;

* `backend/running_text_video_generator/tests.py` &ndash; все тесты Django-приложения: протестированы как скрипт для создания строки, так и единственный view для обработки запросов на сервер;

* `backend/running_text_video_generator/views.py` &ndash; реализация обработки запросов на сервер через class-based views.

## Docker

Имеет два контейнера &ndash; для Django и PostgreSQL. Перед каждым запуском проверяет актуальность всех миграций и соединение с базой данных при помощи bash-скрипта `backend/entrypoint.sh`. Все переменные окружения хранятся внутри `.env.dev`.

## Тесты

Написаны тесты как для проверки корректности работы скрипта по генерации строки, так и единственного class-based view. Запускаются [по инструкции выше](#запуск-тестов). Так как правильность созданного видео можно проверить только при помощи органов зрения, то в основном тестируются смежные компоненты: верность формата данных, корректность возвращаемого запроса, отсутствие видеороликов в папке `backend/media` после работы скрипта.

## Пояснение к ТЗ

Делаем скрипт для создания видео бегущей строки (100 на 100, длина 3 секунды)

* Реализован внутри `backend/running_text_video_generator/entity/running_line_clip.py`. Код с тестами в `backend/running_text_video_generator/tests.py`. Для запуска тестов используется [инструкция выше](#запуск-тестов).

Размещаем на Google Colab

* [Скрипт по генерации бегущей строки в Google Colab](https://colab.research.google.com/drive/14LZOMrlwBhuKXgXALn0G0_u2DHlLpv2y#scrollTo=4a9L0tbQ1B8j).

Создать View для Django

* View `RunningLineClipView` расположен в `backend/running_text_video_generator/views.py` и реализует только GET-запрос [по инструкции](#запуск-тестов).

Развернуть Django на Linux

* Приложение развёрнуто на Docker-контейнере вместе с PostgreSQL базой данных.

Сохранять в БД все запросы

* Текст всех удачных запросов отправляется на базу данных через модель `TextLog`, которая находится внутри `backend/running_text_video_generator/models.py`.

Выложить на Github

* Этот репозиторий &ndash; самая актуальная версия тестового задания.

Улучшения по желанию, опыту

  * Реализовано простое представление клиента через `frontend`

  * Добавлены тесты для проверки надёжности приложения

  * Для удобства запуска весь проект загружен в Docker-контейнеры

Важно! Писать подробный лог в чате

* Выполнено.
